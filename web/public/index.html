<html>
<script src="/socket.io/socket.io.js"> </script>
<script>
   
</script>

<link href="css/nv.d3.css" rel="stylesheet" type="text/css">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="/js/nv.d3.min.js"></script>


<body>
  <div>
    <div id='chart1'>
      <svg style='height:400px'/>
    </div>
    <div id='chart2'>
      <svg style='height:400px'/>
    </div>
</div>

<script>
    var socket = io.connect('http://127.0.0.1:8080');
    socket.on('connect', function(data){
    });
    
    socket.on('data', function(data){
      var dataToUse = []
      for(var i = 0; i < data.data.length; i++) {
        dataToUse[i] = {
          x: new Date(data.data[i]['x']),
          y: data.data[i]['y']
        }
      }
      redraw( [{
        values: dataToUse,
        key: "Temperature"
      }] );
    })
    
    
    var chart;
    
    nv.addGraph(function() {  
      chart = nv.models.lineChart();
 
      chart.xAxis
        .axisLabel('Date')
        .tickFormat(function(d) {
          return d3.time.format('%H:%M')(new Date(d));
        });
 
      chart.yAxis
        .axisLabel('Temperature')
        .tickFormat(d3.format(',r'));
          
      chart.forceY([40,100])
          
      chart.options({
        showControls: true,
        showLegend: true
      })
          // chart.interpolate('step-before ')

 
      d3.select('svg')
        .datum([])
        .transition().duration(500)
        .call(chart);

 
      nv.utils.windowResize(function() { d3.select('svg').call(chart) });

      return chart;
    });
 
 
    function redraw(datum) {
      d3.select('svg')
        .datum(datum)
        .transition().duration(50)
        .call(chart);
    }
  </script>
</body>
</html>